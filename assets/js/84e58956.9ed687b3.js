"use strict";(self.webpackChunkpredictive_maintenance_docs=self.webpackChunkpredictive_maintenance_docs||[]).push([[752],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>d});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function p(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),s=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},c=function(e){var t=s(e.components);return n.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,c=p(e,["components","mdxType","originalType","parentName"]),m=s(a),d=r,h=m["".concat(l,".").concat(d)]||m[d]||u[d]||o;return a?n.createElement(h,i(i({ref:t},c),{},{components:a})):n.createElement(h,i({ref:t},c))}));function d(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=m;var p={};for(var l in t)hasOwnProperty.call(t,l)&&(p[l]=t[l]);p.originalType=e,p.mdxType="string"==typeof e?e:r,i[1]=p;for(var s=2;s<o;s++)i[s]=a[s];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},8274:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>p,toc:()=>s});var n=a(7462),r=(a(7294),a(3905));const o={},i="Deploy to Azure Sphere",p={unversionedId:"hvac-app/azure-sphere/deploy-to-azure-sphere",id:"hvac-app/azure-sphere/deploy-to-azure-sphere",title:"Deploy to Azure Sphere",description:"Clone the predictive maintenance project",source:"@site/docs/40-hvac-app/20-azure-sphere/30-deploy-to-azure-sphere.md",sourceDirName:"40-hvac-app/20-azure-sphere",slug:"/hvac-app/azure-sphere/deploy-to-azure-sphere",permalink:"/AiPoweredPredictiveMaintenanceDocs/hvac-app/azure-sphere/deploy-to-azure-sphere",draft:!1,editUrl:"https://github.com/gloveboxes/AiPoweredPredictiveMaintenanceDocs/blob/main/docs/40-hvac-app/20-azure-sphere/30-deploy-to-azure-sphere.md",tags:[],version:"current",sidebarPosition:30,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Install developer tools",permalink:"/AiPoweredPredictiveMaintenanceDocs/hvac-app/azure-sphere/install-azure-sphere-developer-tools"},next:{title:"Detecting anomalies",permalink:"/AiPoweredPredictiveMaintenanceDocs/category/detecting-anomalies"}},l={},s=[{value:"Clone the predictive maintenance project",id:"clone-the-predictive-maintenance-project",level:2},{value:"Open the high-level predictive maintenance app in Visual Studio Code",id:"open-the-high-level-predictive-maintenance-app-in-visual-studio-code",level:2},{value:"Select your Avnet starter kit revision",id:"select-your-avnet-starter-kit-revision",level:2},{value:"Configure network and security settings",id:"configure-network-and-security-settings",level:2},{value:"Deploying the predictive maintenance app to Azure Sphere",id:"deploying-the-predictive-maintenance-app-to-azure-sphere",level:2},{value:"View debugger output",id:"view-debugger-output",level:3},{value:"Deploy the real-time movement classification app",id:"deploy-the-real-time-movement-classification-app",level:2},{value:"Generate fault prediction data",id:"generate-fault-prediction-data",level:2}],c={toc:s};function u(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"deploy-to-azure-sphere"},"Deploy to Azure Sphere"),(0,r.kt)("h2",{id:"clone-the-predictive-maintenance-project"},"Clone the predictive maintenance project"),(0,r.kt)("h2",{id:"open-the-high-level-predictive-maintenance-app-in-visual-studio-code"},"Open the high-level predictive maintenance app in Visual Studio Code"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Start Visual Studio Code"),(0,r.kt)("li",{parentName:"ol"},"From the Visual Studio Code main menu, select ",(0,r.kt)("strong",{parentName:"li"},"File"),", then select ",(0,r.kt)("strong",{parentName:"li"},"Open folder"),"."),(0,r.kt)("li",{parentName:"ol"},"Navigate to the ",(0,r.kt)("strong",{parentName:"li"},"AzureSphere")," folder you cloned to your computer, then select ",(0,r.kt)("strong",{parentName:"li"},"classifyHL"),", and open.")),(0,r.kt)("h2",{id:"select-your-avnet-starter-kit-revision"},"Select your Avnet starter kit revision"),(0,r.kt)("p",null,"The default board is the Avnet Starter Kit Rev 1. If this is the board and sensor you're using, then skip to the next step."),(0,r.kt)("p",null,"If you have an Avnet Starter Kit Rev 2 board then follow these instructions."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Open the ",(0,r.kt)("strong",{parentName:"li"},"CMakeLists.txt")," file."),(0,r.kt)("li",{parentName:"ol"},"Comment out the Avnet Rev 1 board with a ",(0,r.kt)("strong",{parentName:"li"},"#"),"."),(0,r.kt)("li",{parentName:"ol"},"Uncomment the Avnet Rev 2 board by removing the leading ",(0,r.kt)("strong",{parentName:"li"},"#")," character."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Save")," the changes.")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"configure-network-and-security-settings"},"Configure network and security settings"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Open the ",(0,r.kt)("strong",{parentName:"p"},"app_manifest.json")," file.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Update the ",(0,r.kt)("strong",{parentName:"p"},"CmdArgs")," property with your IoT Central ",(0,r.kt)("strong",{parentName:"p"},"ID Scope"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Get your Azure Sphere Tenant ID. From a ",(0,r.kt)("strong",{parentName:"p"},"command prompt"),", run the following command."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},"azsphere tenant show-selected -o yaml\n")),(0,r.kt)("p",{parentName:"li"},"The output of this command will be similar to the following. The ",(0,r.kt)("strong",{parentName:"p"},"id")," property value is your Azure Sphere Tenant ID."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"id: 9abc79eb-9999-43ce-9999-fa8888888894\nname: myAzureSphereTenant\nroles:\n- Administrator\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Update the ",(0,r.kt)("strong",{parentName:"p"},"DeviceAuthentication")," property with your ",(0,r.kt)("strong",{parentName:"p"},"Azure Sphere Tenant ID"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"update the ",(0,r.kt)("strong",{parentName:"p"},"CmdArgs")," property with your Azure DPS ",(0,r.kt)("strong",{parentName:"p"},"ID Scope"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Update the ",(0,r.kt)("strong",{parentName:"p"},"AllowedConnections")," property with your Azure IoT Hub ",(0,r.kt)("strong",{parentName:"p"},"Hostname"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Review")," your updated manifest_app.json file. It should be similar to the following."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "SchemaVersion": 1,\n    "Name": "classify_solution",\n    "ComponentId": "25025d2c-66da-4448-bae1-ac26fcdd3627",\n    "EntryPoint": "/bin/app",\n    "CmdArgs": [\n        "--ScopeID",\n        "<REPLACE_WITH_YOUR_AZURE_DPS_ID_SCOPE>"\n    ],\n    "Capabilities": {\n        "I2cMaster": [\n            "$ISU2_I2C"\n        ],\n        "Pwm": [\n            "$PWM_RGB_CONTROLLER"\n        ],\n        "Adc": [\n            "$Adc0"\n        ],\n        "Gpio": [\n            "$NETWORK_CONNECTED_LED",\n            "$APP_STATUS_LED",\n            "$EN",\n            "$NSL",\n            "$PH",\n            "$BUTTON_A",\n            "$BUTTON_B",\n            "$RELAY_2",\n            "$RELAY_EXT"\n        ],\n        "AllowedConnections": [\n            "global.azure-devices-provisioning.net",\n            "<REPLACE_WITH_YOUR_IOT_HUB_HOSTNAME>",\n\n        ],\n        "DeviceAuthentication": "<REPLACE_WITH_YOUR_AZURE_SPHERE_TENANT_ID>",\n        "AllowedApplicationConnections": [\n            "AF8B26DB-355E-405C-BBDE-3B851668EE23"\n        ]\n    },\n    "ApplicationType": "Default"\n}\n\n')))),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"deploying-the-predictive-maintenance-app-to-azure-sphere"},"Deploying the predictive maintenance app to Azure Sphere"),(0,r.kt)("p",null,"Start the app build deploy process."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Press ",(0,r.kt)("kbd",null,"Ctrl+Shift+P")," to open the Visual Studio Code command palette."),(0,r.kt)("li",{parentName:"ol"},"Type and select ",(0,r.kt)("strong",{parentName:"li"},"CMake: Select Variant"),", then select ",(0,r.kt)("strong",{parentName:"li"},"Debug"),"."),(0,r.kt)("li",{parentName:"ol"},"Press ",(0,r.kt)("kbd",null,"F5")," to build, deploy, and attach the debugger to the application now running the Azure Sphere device.")),(0,r.kt)("h3",{id:"view-debugger-output"},"View debugger output"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Open the Visual Studio Code ",(0,r.kt)("strong",{parentName:"p"},"Output")," tab to view the output from the ",(0,r.kt)("strong",{parentName:"p"},"Log_Debug")," statements in the code."),(0,r.kt)("blockquote",{parentName:"li"},(0,r.kt)("p",{parentName:"blockquote"},"Pro Tip. You can open the output window by using the Visual Studio Code ",(0,r.kt)("kbd",null,"Ctrl+K Ctrl+H")," shortcut or selecting the ",(0,r.kt)("strong",{parentName:"p"},"Output")," tab."))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"You will see the device negotiating security with Azure IoT Central."))),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"deploy-the-real-time-movement-classification-app"},"Deploy the real-time movement classification app"),(0,r.kt)("p",null,"The easiest way to deploy the real-time movement classification app is to deploy the prebuilt image package."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"From a command prompt, navigate to the ",(0,r.kt)("em",{parentName:"p"},"AzureSphereClassify")," folder, then to the ",(0,r.kt)("em",{parentName:"p"},"image_packages")," folder.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Run the following command to sideload the real-time app."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"azsphere device sideload -p FreeRTOS_RTcore_I2C_Accelerometer.imagepackage\n")))),(0,r.kt)("p",null,"You can also deploy the real-time movement classification app to the Azure Sphere using Visual Studio Code."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Copy the ",(0,r.kt)("em",{parentName:"p"},"AzureSphereRTCoreToolchainEdgeImpulse.cmake")," found in the root of the ",(0,r.kt)("em",{parentName:"p"},"AzureSphereClassify")," folder to the Azure Sphere SDK CMakeFiles folder."),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"On Windows the Azure Sphere SDK CMakeFiles folder is located at ",(0,r.kt)("em",{parentName:"li"},"C:\\Program Files (x86)\\Microsoft Azure Sphere SDK\\CMakeFiles"),"."),(0,r.kt)("li",{parentName:"ul"},"On Ubuntu the Azure Sphere SDK CMakeFiles folder is located at ",(0,r.kt)("em",{parentName:"li"},"/opt/azurespheresdk/CMakeFiles"),"."))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Open the ",(0,r.kt)("strong",{parentName:"p"},"classifyRT")," folder with Visual Studio Code.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Type and select ",(0,r.kt)("strong",{parentName:"p"},"CMake: Select Variant"),", then select ",(0,r.kt)("strong",{parentName:"p"},"Release"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Press ",(0,r.kt)("kbd",null,"Ctrl+F5")," to build and deploy the app to your Azure Sphere device."))),(0,r.kt)("h2",{id:"generate-fault-prediction-data"},"Generate fault prediction data"),(0,r.kt)("p",null,"The predictive maintenance model was trained with the following gestures."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Keeping the device horizontal, move the device side to side, this will generate an HVAC ",(0,r.kt)("em",{parentName:"li"},"rattle")," prediction."),(0,r.kt)("li",{parentName:"ol"},"Generate an HVAC motor ",(0,r.kt)("em",{parentName:"li"},"bearings")," prediction by moving the device with a ",(0,r.kt)("em",{parentName:"li"},"wave")," gesture."),(0,r.kt)("li",{parentName:"ol"},"The model has also been trained with an HVAC ",(0,r.kt)("em",{parentName:"li"},"up and down"),".")))}u.isMDXComponent=!0}}]);